#!/usr/bin/env node

const chalk = require('chalk')
const home = require('user-home')
const download = require('download-git-repo')
const rm = require('rimraf').sync
const ora = require('ora')
const fs = require('fs-extra')
const path = require('path')

console.log()
process.on('exit', () => {
  console.log()
})

const lib = 'gitlab:gitlab.gz.cvte.cn:seewo_dove/schoolweb/00templates'
const tmp = path.join(home, '.school-templates', '00templates')
const tmpFile = path.join(tmp, 'templates.json')

function downloadTemplatesLib(){
  const spinner = ora('正在获取列表……')
  spinner.start()
  if (fs.existsSync(tmp)) rm(tmp)
  download(lib, tmp, { clone: true }, err => {
    spinner.stop()
    if (err) console.log(chalk.red('获取模板列表失败'))

    const templates = fs.readJsonSync(tmpFile)

    if (Array.isArray(templates)) {
      templates.forEach(repo => {
        console.log(
          '  ' + chalk.yellow('★') +
          '  ' + chalk.blue(repo.name) +
          ' - ' + repo.description)
      })
    } else {
      console.error('无登记模板')
    }
  })
}

downloadTemplatesLib()

